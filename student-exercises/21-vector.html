<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252"><script src="pencilcodeguide.js"></script>
<script>

function filterblocks(a) {
  // Show 'say' block only on browsers that support speech synthesis.
  if (!window.SpeechSynthesisUtterance || !window.speechSynthesis) {
    a = a.filter(function(b) { return !/^@?say\b/.test(b.block); });
  }
  // Show 'listen' blocks only on browsers that support speech recognition.
  if (!window.webkitSpeechRecognition || window.SpeechRecognition) {
    a = a.filter(function(b) { return !/\blisten\b/.test(b.block); });
  }
  return a.map(function(e) {
    if (!e.id) {
      // As the id (for logging), use the first (non-puncutation) word
      e.id = e.block.replace(/^\W*/, '').
             replace(/^new /, '').replace(/\W.*$/, '');
      // If that doesn't turn into anything, use the whole block text.
      if (!e.id) { e.id = e.block; }
    }
    return e;
  });
}

//  This is where we customize the blocks palette 
PencilCodeGuide.session(
{
  palette : [
    {
      name: 'Move',
      color: 'lightblue',
      blocks: filterblocks([
        {
          block: '@fd 100',
          title: 'Move forward'
        }, {
          block: '@rt 90',
          title: 'Turn right'
        }, 
        {
          block: '@lt 90',
          title: 'Turn left'
        }, {
          block: '@bk 100',
          title: 'Move backward'
        }, 
        // {
        //   block: '@rt 180, 100',
        //   title: 'Make a wide right arc'
        // }, {
        //   block: '@lt 180, 100',
        //   title: 'Make a wide left arc'
        // }, 
        {
          block: '@speed 10',
          title: 'Set the speed of the turtle'
        }, 
        // {
        //   block: '@speed Infinity',
        //   title: 'Use infinite speed'
        // }, 
        // {
        //   block: '@home()',
        //   title: 'Jump to the origin, turned up'
        // }, {
        //   block: '@turnto 270',
        //   title: 'Turn to an absolute direction'
        // }, {
        //   block: '@moveto 100, 50',
        //   title: 'Move to coordinates'
        // }, {
        //   block: '@movexy 30, 20',
        //   title: 'Move by changing x and y'
        // }, 
        {
          block: '@jumpto 100, 50',
          title: 'Jump to coordinates without drawing'
        }, 
        // {
        //   block: '@jumpxy 30, 20',
        //   title: 'Jump changing x and y without drawing'
        // }, {
        //   block: '@pause 5',
        //   title: 'Do not move for five seconds'
        // }
      ])
    }, {
      name: 'Control',
      color: 'orange',
      blocks: filterblocks([
        // {
        //   block: 'for [1..3]\n  ``',
        //   title: 'Do something multiple times'
        // }, {
        //   block: 'for x in [0...10]\n  ``',
        //   title: 'Repeat something while counting up x'
        // }, {
        //   block: 'while `` < ``\n  ``',
        //   title: '  Repeat while a condition is true'
        // }, 
        // {
        //   block: 'if `` is ``\n  ``',
        //   title: 'Do something only if a condition is true'
        // }, 
        {
          block: 'if `` > ``\n  ``',
          title: 'Do something only if the left hand side is greater than the right'
        }, 
        // {
        //   block: 'if `` is ``\n  ``\nelse\n  ``',
        //   title:
        //       'Do something if a condition is true, otherwise something else',
        //   id: 'ifelse'
        // }, {
        //   block: "forever 1, ->\n  ``",
        //   title: 'Repeat something forever at qually-spaced times'
        // }, {
        //   block: "button \'Click\', ->\n  ``",
        //   title: 'Make a button and do something when clicked'
        // }, {
        //   block: "keydown \'X\', ->\n  ``",
        //   title: 'Do something when a keyboard key is pressed'
        // }, {
        //   block: "click (e) ->\n  ``",
        //   title: 'Do something when the mouse is clicked'
        // }
      ])
    }, {
      name: 'Art',
      color: 'purple',
      blocks: filterblocks([
         {
          block: '@pen purple, 10',
          title: 'Set pen color and size'
        }, 
        // {
        //   block: '@dot green, 50',
        //   title: 'Make a dot'
        // }, {
        //   block: '@box yellow, 50',
        //   title: 'Make a square'
        // }, {
        //   block: '@fill blue',
        //   title: 'Fill traced shape'
        // }, {
        //   block: '@wear \'apple\'',
        //   title: 'Use an image for the turtle'
        // }, {
        //   block: 'img \'/img/bird\'',
        //   title: 'Write an image on the screen'
        // }, {
        //   block: '@grow 3',
        //   title: 'Grow the size of the turtle'
        // }, {
        //   block: '@hide()',
        //   title: 'Hide the main turtle'
        // }, {
        //   block: '@show()',
        //   title: 'Show the main turtle'
        // }, {
        //   block: 'cs()',
        //   title: 'Clear screen'
        // }, {
        //   block: '@pu()',
        //   title: 'Lift the pen up'
        // }, {
        //   block: '@pd()',
        //   title: 'Put the pen down'
        // }, {
        //   block: '@drawon s',
        //   title: 'Draw on sprite s'
        // }, {
        //   block: '@drawon document',
        //   title: 'Draw on the document'
        // }
      ])
    }, {
      name: 'Operators',
      color: 'lightgreen',
      blocks: filterblocks([
        {
          block: 'x = 0',
          title: 'Set a variable',
          id: 'assign'
        }, 
        {
          block: 'x += 1',
          title: 'Increase a variable',
          id: 'increment'
        }, 
        {
          block: 'f = (x) ->\n  ``',
          title: 'Define a new function',
          id: 'funcdef'
        }, {
          block: 'f(x)',
          title: 'Use a custom function',
          id: 'funccall'
        }, 
        // {
        //   block: '`` is ``',
        //   title: 'Compare two values',
        //   id: 'is'
        // }, 
        // {
        //   block: '`` < ``',
        //   title: 'Compare two values',
        //   id: 'lessthan'
        // }, 
        {
          block: '`` > ``',
          title: 'Compare two values',
          id: 'greaterthan'
        }, 
        {
          block: '`` + ``',
          title: 'Add two numbers',
          id: 'add'
        }, 
        // {
        //   block: '`` - ``',
        //   title: 'Subtract two numbers',
        //   id: 'subtract'
        // }, 
        // {
        //   block: 'return `` - ``',
        //   title: 'Subtract two numbers',
        //   id: 'mysub'
        // }, 
        {
          block: 'return ``',
          title: 'return a value',
          id: 'myreturn'
        }, 
        {
          block: '`` * ``',
          title: 'Multiply two numbers',
          id: 'multiply'
        }, 
        // {
        //   block: '`` / ``',
        //   title: 'Divide two numbers',
        //   id: 'divide'
        // }, 
        // {
        //   block: '`` and ``',
        //   title: 'True if both are true',
        //   id: 'and'
        // }, {
        //   block: '`` or ``',
        //   title: 'True if either is true',
        //   id: 'or'
        // }, {
        //   block: 'not ``',
        //   title: 'True if input is false',
        //   id: 'not'
        // }, 
        {
          block: 'random 6',
          title: 'Get a random number less than n'
        }, 
        // {
        //   block: 'round ``',
        //   title: 'Round to the nearest integer'
        // }, {
        //   block: 'abs ``',
        //   title: 'Absolute value'
        // }, {
        //   block: 'max ``, ``',
        //   title: 'Get the larger of two numbers'
        // }, {
        //   block: 'min ``, ``',
        //   title: 'Get the smaller on two numbers'
        // }, {
        //   block: 'x.match /pattern/',
        //   title: 'Test if a text pattern is found in x',
        //   id: 'match'
        // }
      ])
    }, {
      name: 'Text',
      color: 'pink',
      blocks: filterblocks([
        {
          block: 'write \'Hello.\'',
          title: 'Write text in the document'
        }, 
        // {
        //   block: 'debug x',
        //   title: 'Log an object to debug'
        // }, {
        //   block: 'type \'zz*(-.-)*zz\'',
        //   title: 'Typewrite text in the document'
        // }, {
        //   block: 'typebox yellow',
        //   title: 'Type out a colored square'
        // }, {
        //   block: 'typeline()',
        //   title: 'Type in a new line'
        // }, {
        //   block: '@label \'spot\'',
        //   title: 'Write text at the turtle'
        // }, {
        //   block: "await read '?', defer x",
        //   title: "Pause for input from the user"
        // }, {
        //   block: "await readnum '?', defer x",
        //   title: "Pause for a number from the user"
        // }, {
        //   block: 'read \'?\', (x) ->\n  write x',
        //   title: 'Send input from the user to a function'
        // }, {
        //   block: 'readnum \'?\', (x) ->\n  write x',
        //   title: 'Send a number from the user to a function'
        // }
      ])
    }, 
    //{
    //   name: 'Sprites',
    //   color: 'teal',
    //   blocks: filterblocks([
    //     {
    //       block: 't = new Turtle red',
    //       title: 'Make a new turtle',
    //       id: 'newturtle'
    //     }, {
    //       block: 's = new Sprite()',
    //       title: 'Make a blank sprite',
    //       id: 'newsprite'
    //     }, {
    //       block: 'p = new Piano()',
    //       title: 'Make a visible instrument',
    //       id: 'newpiano'
    //     }, {
    //       block: 'q = new Pencil()',
    //       title: 'Make an invisible and fast drawing sprite'
    //     }, {
    //       block: 'if @touches x\n  ``',
    //       title: 'Do something only if touching the object x'
    //     }, {
    //       block: 'if @inside window\n  ``',
    //       title: 'Do something only if inside the window'
    //     }
    //   ])
    // }, {
    //   name: 'Sound',
    //   color: 'indigo',
    //   blocks: filterblocks([
    //     {
    //       block: '@play \'c G/G/ AG z\'',
    //       title: 'Play music notes in sequence'
    //     }, {
    //       block: '@play \'[fA] [ecG]2\'',
    //       title: 'Play notes in a chord'
    //     }, {
    //       block: '@tone \'B\', 2, 1',
    //       title: 'Sound a note immediately',
    //       id: 'toneNote'
    //     }, {
    //       block: '@tone \'B\', 0',
    //       title: 'Silence a note immediately',
    //       id: 'toneNote0'
    //     }, {
    //       block: '@tone 440, 2, 1',
    //       title: 'Sound a frequency immediately',
    //       id: 'toneHz'
    //     }, {
    //       block: '@tone 440, 0',
    //       title: 'Silence a frequency immediately',
    //       id: 'toneHz0'
    //     }, {
    //       block: '@silence()',
    //       title: 'Silence all notes'
    //     }, {
    //       block: "await listen defer x",
    //       title: "Pause for spoken words from the user"
    //     }, {
    //       block: 'listen (x) ->\n  write x',
    //       title: 'Send spoken words from the user to a function'
    //     }, {
    //       block: '@say \'hello\'',
    //       title: 'Speak a word'
    //     }, {
    //       block: 'new Audio(url).play()',
    //       expansion: '(new Audio(\'https://upload.wikimedia.org/wikipedia/commons/1/11/06_-_Vivaldi_Summer_mvt_3_Presto_-_John_Harrison_violin.ogg\')).play()',
    //       title: 'Play an audio file'
    //     }
    //   ])
    // }, 
    {
      name: 'Snippets',
      color: 'deeporange',
      blocks: filterblocks([
        {
          block: "(documents = ['I AM SAM I AM SAM SAM I AM','THAT SAM I AM THAT SAM I AM I DO NOT LIKE THAT SAM I AM','DO WOULD YOU LIKE GREEN EGGS AND HAM','I DO NOT LIKE THEM SAM I AM I DO NOT LIKE GREEN EGGS AND HAM','WOULD YOU LIKE THEM HERE OR THERE','I WOULD NOT LIKE THEM HERE OR THERE I WOULD NOT LIKE THEM ANYWHERE I DO NOT LIKE GREEN EGGS AND HAM I DO NOT LIKE THEM SAM I AM','WOULD YOU LIKE THEM IN A HOUSE WOULD YOU LIKE THEN WITH A MOUSE','I DO NOT LIKE THEM IN A HOUSE I DO NOT LIKE THEM WITH A MOUSE I DO NOT LIKE THEM HERE OR THERE I DO NOT LIKE THEM ANYWHERE I DO NOT LIKE GREEN EGGS AND HAM I DO NOT LIKE THEM SAM I AM','WOULD YOU EAT THEM IN A BOX WOULD YOU EAT THEM WITH A FOX','NOT IN A BOX NOT WITH A FOX NOT IN A HOUSE NOT WITH A MOUSE I WOULD NOT EAT THEM HERE OR THERE I WOULD NOT EAT THEM ANYWHERE I WOULD NOT EAT GREEN EGGS AND HAM I DO NOT LIKE THEM SAM I AM','WOULD YOU COULD YOU IN A CAR EAT THEM EAT THEM HERE THEY ARE','I WOULD NOT COULD NOT IN A CAR','YOU MAY LIKE THEM YOU WILL SEE YOU MAY LIKE THEM IN A TREE','I WOULD NOT COULD NOT IN A TREE NOT IN A CAR YOU LET ME BE I DO NOT LIKE THEM IN A BOX I DO NOT LIKE THEM WITH A FOX I DO NOT LIKE THEM IN A HOUSE I DO NOT LIKE THEM WITH A MOUSE I DO NOT LIKE THEM HERE OR THERE I DO NOT LIKE THEM ANYWHERE I DO NOT LIKE GREEN EGGS AND HAM I DO NOT LIKE THEM SAM I AM','A TRAIN A TRAIN A TRAIN A TRAIN COULD YOU WOULD YOU ON A TRAIN','NOT ON TRAIN NOT IN A TREE NOT IN A CAR SAM LET ME BE I WOULD NOT COULD NOT IN A BOX I WOULD NOT COULD NOT WITH A FOX I WILL NOT EAT THEM IN A HOUSE I WILL NOT EAT THEM HERE OR THERE I WILL NOT EAT THEM ANYWHERE I DO NOT EAT GREEN EGGS AND HAM I DO NOT LIKE THEM SAM I AM','SAY IN THE DARK HERE IN THE DARK WOULD YOU COULD YOU IN THE DARK','I WOULD NOT COULD NOT IN THE DARK','WOULD YOU COULD YOU IN THE RAIN','I WOULD NOT COULD NOT IN THE RAIN NOT IN THE DARK NOT ON A TRAIN NOT IN A CAR NOT IN A TREE I DO NOT LIKE THEM SAM YOU SEE NOT IN A HOUSE NOT IN A BOX NOT WITH A MOUSE NOT WITH A FOX I WILL NOT EAT THEM HERE OR THERE I DO NOT LIKE THEM ANYWHERE','YOU DO NOT LIKE GREEN EGGS AND HAM','I DO NOT LIKE THEM SAM I AM','COULD YOU WOULD YOU WITH A GOAT','I WOULD NOT COULD NOT WITH A GOAT','WOULD YOU COULD YOU ON A BOAT','I COULD NOT WOULD NOT ON A BOAT I WILL NOT WILL NOT WITH A GOAT I WILL NOT EAT THEM IN THE RAIN NOT IN THE DARK NOT IN A TREE NOT IN A CAR YOU LET ME BE I DO NOT LIKE THEM IN A BOX I DO NOT LIKE THEM WITH A FOX I WILL NOT EAT THEM IN A HOUSE I DO NOT LIKE THEM WITH A MOUSE I DO NOT LIKE THEM HERE OR THERE I DO NOT LIKE THEM ANYWHERE I DO NOT LIKE GREEN EGGS AND HAM I DO NOT LIKE THEM SAM I AM','YOU DO NOT LIKE THEM SO YOU SAY TRY THEM TRY THEM AND YOU MAY TRY THEM AND YOU MAY I SAY','SAM IF YOU LET ME BE I WILL TRY THEM YOU WILL SEE','SAY I LIKE GREEN EGGS AND HAM I DO I LIKE THEM SAM I AM AND I WOULD EAT THEM IN A BOAT AND I WOULD EAT THEM WITH A GOAT AND I WILL EAT THEM IN THE RAIN AND IN THE DARK AND ON A TRAIN AND IN A CAR AND IN A TREE THEY ARE SO GOOD SO GOOD YOU SEE SO I WILL EAT THEM IN A BOX AND I WILL EAT THEM WITH A FOX AND I WILL EAT THEM IN A HOUSE AND I WILL EAT THEM WITH A MOUSE AND I WILL EAT THEM HERE AND THERE SAY I WILL EAT THEM ANYWHERE I DO SO LIKE GREEN EGGS AND HAM THANK YOU THANK YOU SAM I AM'])",
          title: "documents data block",
          id: "document-data"
        },
        {
          block: "(write 'Ex 1. Create a term document matrix'\ntermDocumentMatrix = {}\ndocCount = 0\nfor doc in documents\n  for word in doc.split(' ')\n    if not termDocumentMatrix[word]?\n      termDocumentMatrix[word] = {}\n    if not termDocumentMatrix[word][docCount]?\n      termDocumentMatrix[word][docCount] = ``\n    else\n      termDocumentMatrix[word][docCount] += ``\n  docCount++\ntype JSON.stringify(termDocumentMatrix,null,2))",
          title: "Ex 1 term document matrix",
          id: "term-doc-matrix"
        },
        {
          block: "(write 'Ex 2. Query the term document matrix'\nCosine = (v1,v2,range) ->\n  dotproduct = ``\n  v1norm = 0\n  v2norm = 0\n  for i in range\n    if v1[i]? and v2[i]?\n      dotproduct += v1[i] * v2[i]\n    if v1[i]?\n      v1norm += v1[i] * v1[i]\n    if v2[i]?\n      v2norm += v2[i] * v2[i]\n  return dotproduct / (Math.sqrt(v1norm) * Math.sqrt(v2norm))\nDoWordQueries = () ->\n  range = [0..docCount]\n  write 'Cosine of MAY and GOOD ' + Cosine(termDocumentMatrix['MAY'],termDocumentMatrix['GOOD'],range)\n  write 'Cosine of THANK and GOOD ' + Cosine(termDocumentMatrix['THANK'],termDocumentMatrix['GOOD'],range)\n  write 'Cosine of GOAT and HOUSE ' + Cosine(termDocumentMatrix['GOAT'],termDocumentMatrix['HOUSE'],range)\n  write 'Cosine of A and DARK ' + Cosine(termDocumentMatrix['A'],termDocumentMatrix['DARK'],range)\nDoWordQueries())",
          title: "Ex 2 Query term document matrix",
          id: "query-termdoc"
        },
        {
          block: "(write 'Ex 3. Transform the matrix using TF.IDF'\nfor word,vector of termDocumentMatrix\n  for documentId,count of vector\n    termDocumentMatrix[word][documentId] = (1 + Math.log10(count))*Math.log10(docCount/Object.keys(vector).length)\ntype JSON.stringify(termDocumentMatrix,null,2)\nDoWordQueries())",
          title: "Ex 3 TF.IDF",
          id: "tfidf"
        },
        {
          block: "(write 'Ex 4. Do document search'\ndocumentTermMatrix = {}\nfor word,vector of termDocumentMatrix\n  for documentId,count of vector\n    if not documentTermMatrix[documentId]?\n      documentTermMatrix[documentId] = {}\n    documentTermMatrix[documentId][word] = count\ntype JSON.stringify(documentTermMatrix,null,2)\nDocumentSearch = (query,n) ->\n  queryVector = {}\n  for word in query.split(' ')\n    queryVector[word] = 1\n  scores = []\n  for docId,docVector of documentTermMatrix\n    score = Cosine(queryVector,docVector,Object.keys(termDocumentMatrix))\n    scores.push( {score:score,document:documents[docId]} )\n  scores.sort (a, b) -> b.score - a.score\n  return scores[0..n]\nquery = 'CAR'\ntype 'Document search results for ' + query + ':' + JSON.stringify(DocumentSearch(query,5),null,2))",
          title: "Ex 4 document search",
          id: "document-search"
        },
        {
          block: "(write 'Ex 5. Run Word2Vec'\nex5_link = 'https://umdrive.memphis.edu/aolney/public/pencilcode/word2vec/index.html'\nLaunchLink = (link) ->\n  $('<iframe src=' + link + ' width=900px height=1000px></iframe>').appendTo('body');\nLaunchLink( ex5_link ))",
          title: "Ex 5 word2vec",
          id: "word2vec"
        },
        //--------------------------------------------------------
        // {
        //   block: "(turtle.remove()\nspeed 100\nfoxLine = new Turtle()\nfoxLine.pen red, 1\nhareLine = new Turtle()\nhareLine.pen green, 1)",
        //   title: "Set up Lotka-Volterra simulation",
        //   id: "lotka-setup"
        // },
        // {
        //   block: "(for time in [1..500] by 10\n  hareLine.moveto time,hares\n  foxLine.moveto time,foxes\n  hares += NewHares hares,foxes\n  foxes += NewFoxes hares,foxes)",
        //   title: "Run Lotka-Volterra simulation",
        //   id: "run-lotka-simulation"
        // },
        // {
        //   block: "forever 10, ->\n  turnto lastmouse\n  fd 2",
        //   title: 'Continually move towards the last mouse position',
        //   id: "foreverFollowMouse"
        // }, {
        //   block: "forever 10, ->\n  if pressed 'W'\n    fd 2",
        //   title: 'Poll a key and move while it is depressed',
        //   id: "foreverPollKey"
        // }, {
        //   block: "forever 1, ->\n  fd 25\n  if not inside window\n    stop()",
        //   title: 'Move once per second until not inside window',
        //   id: "foreverInsideWindow"
        // }, {
        //   block: "click (e) ->\n  moveto e",
        //   title: 'Move to a location when document is clicked',
        //   id: "foreverMovetoClick"
        // }, {
        //   block: "button \'Click\', ->\n  write 'clicked'",
        //   title: 'Make a button and do something when clicked',
        //   id: "buttonWrite"
        // }, {
        //   block: "keydown \'X\', ->\n  write 'x pressed'",
        //   title: 'Do something when a keyboard key is pressed',
        //   id: "keydownWrite"
        // }, {
        //   block: "click (e) ->\n  moveto e",
        //   title: 'Move to a location when document is clicked',
        //   id: "clickMove"
        // }
      ])
    }
  ]
}
);
</script>
</head><body><h1>Vector Spaces</h1>

<p>We're going to use a short and hopefully familiar dataset, Green Eggs and Ham. This has some additional advantages that it only has 50 words, and these are heavily repeated across documents.
  </p>

<p>This is a multi-step exercise. Do the following in order:</p>
<ul>
    <li>Get the document block</li>
    <li>Get Ex 1 block. This block builds a term-document matrix using the documents.</li>
    <ul>
      <li>Fill in the blanks. Hint: we are filling the term-document matrix by counting words</li>
      <li>Run the program. Scroll up and down. Notice that each word is followed by a map giving the numeric id of a sentence and the # times the word appears in that sentence.</li>
    </ul>
    <li>Get Ex 2 block. This block calculates similarity between vectors in the term-document matrix</li>
    <ul>
      <li>Fill in the blank. Hint: we are doing a sum.</li>
      <li>Run the program to compare the similarity of words. Scroll all the way down. Notice that word pairs have cosines of 0, 1, and values in between.</li>
      <li>Find the vectors for each word pair by scrolling up. What can you say about the pairs that have a cosine of 0 or 1?</li>
    </ul>
    <li>Get Ex 3 block</li>
    <ul>
      <li>Run the program. This block transforms the matrix using TF.IDF.</li>
      <li>Scroll up/down to see the original matrix and the matrix after transforming with TF.IDF.</li>
      <li>Notice that the TF.IDF has many vector elements that are the same value, e.g. .86. Why is that? Why are some elements different from the rest?</li>
    </ul>
    <li>Get Ex 4 block. This block inverts the term document matrix to make a document term matrix and then does searches on it.</li>
    <ul>
      <li>Run it and scroll all the way down. </li>
      <li>Do the results look reasonable to you?</li>
      <li>Try a couple of different queries, like "CAR" and "CAR EAT".</li>
      <li>Notice how the order of search results changes with slightly different queries.</li>
    </ul>
    <li>Get Ex 5 block. This block does word2vec.</li>
    <ul>
      <li>Run it and scroll all the way down. You should see an embedded web page.</li>
      <li>The words that are crossed out occur less than 5 times, so are not part of the model.</li>
      <li>First, try the "nearest neighbors" button. Try different words. Do they make sense?</li>
      <li>Next, try the "analogy" button. Look back at the text. Is the analogy a good one? Try another.</li>
      <li>Try getting a vector for one of the words you tried. Notice the values are all nonzero. Some are positive ans ome are negative. Most are very small.</li>
    </ul>
  </ul>

<!-- <img alt="Strahler branching order" src="strahler.jpg" width=500> -->

</body></html>
